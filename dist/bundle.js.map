{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/Page.ts","src/VideoControls.ts","src/main.ts","src/util.ts"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import { VideoControls } from \"./VideoControls\";\n\nconst movieSfx = ['mov', 'mp4'];\nconst imgSfx = ['jpg', 'png', 'webp'];\n\nfunction fillImage(item : HTMLElement, src: string) {\n    const width = parseInt(item.dataset['width']);\n    const height = parseInt(item.dataset['height']);\n    const alt = item.dataset['alt'] || \"UI image\";\n\n    const img = new Image(width, height);\n    img.classList.add('poster');\n    img.onload = () => img.classList.add('visible');\n    img.alt = alt;\n    img.src = src;\n\n    const container = item.querySelector('.frame') || item;\n\n    container.insertAdjacentElement('beforeend', img);\n}\n\nfunction fillMovie(item: HTMLElement, src: string) {\n    const width = parseInt(item.dataset['width']);\n    const height = parseInt(item.dataset['height']);\n\n    const movie = document.createElement(\"video\");\n    movie.width = width;\n    movie.height = height;\n    movie.classList.add('poster');\n    const controls = new VideoControls(movie);\n\n    const container = item.querySelector('.frame') || item;\n    container.insertAdjacentElement('beforeend', movie);\n    container.insertAdjacentElement('beforeend', controls.ui);\n\n    movie.src = src;\n}\n\n\nfunction fillItem(item : HTMLElement) {\n    const src = item.dataset['src'];\n    const comps = src.split('.');\n    if (comps.length < 2) {\n        console.warn('No file suffix on source', src);\n        return;\n    }\n\n    const sfx = comps[comps.length - 1];\n\n    if(movieSfx.indexOf(sfx) !== -1) {\n        fillMovie(item, src);\n    } else if (imgSfx.indexOf(sfx) !== -1) {\n        fillImage(item, src);\n    } else {\n        console.warn(\"Don't know how to fill item type: \", sfx);\n    }\n}\n\nfunction didObserve(entries: IntersectionObserverEntry[], observer : IntersectionObserver) {\n    for (const entry of entries) {\n        // Should always be true (?)\n        if (entry.intersectionRatio >= 0.5) {\n            fillItem(entry.target as HTMLElement);\n            observer.unobserve(entry.target);\n        }\n    }\n}\n\nexport function startPage() {\n    const itemElements = document.querySelectorAll('.item');\n    if (!itemElements)\n        return;\n\n    const io = new IntersectionObserver(didObserve, { threshold : 0.5 });\n    itemElements.forEach((el : Element) => io.observe(el));\n}","import { createDom } from \"./util\";\n\nconst formatTime = (time: number) : string => {\n    // @ts-ignore\n    const minutes = `${Math.floor(time / 60)}`.padStart(2, '0');\n    // @ts-ignore\n    const seconds = `${Math.floor(time % 60)}`.padStart(2, '0');\n\n    return `${minutes}:${seconds}`;\n};\n\n\nexport class VideoControls {\n    private video : HTMLVideoElement;\n\n    private duration : number;\n    private durationEl : HTMLElement;\n\n    private progressEl : HTMLElement;\n    private loadProgressEl : HTMLElement;\n    private clockEl : HTMLElement;\n    private playPauseButton : HTMLElement;\n\n    private controlsContainer : HTMLElement;\n\n    constructor(video : HTMLVideoElement) {\n        this.video = video;\n\n        this.setupUI();\n\n        this.video.addEventListener('canplay', this.canPlay);\n        this.video.addEventListener('timeupdate', this.timeUpdate);\n        this.video.addEventListener('progress', this.loadProgress);\n        this.video.addEventListener('ended', this.endedPlayback);\n        this.video.addEventListener('loadedmetadata', this.gotMetadata);\n\n        // Sometimes the video cna be in the ready state before we attach the listeners\n        // If this is the case fill everything in manually...\n        if (this.video.readyState >= 2) {\n            this.canPlay();\n            this.setDuration(this.video.duration);\n            this.loadProgress();\n        }\n    }\n\n    public get ui() {\n        return this.controlsContainer;\n    }\n\n    private setupUI() {\n        this.playPauseButton = createDom('div', ['playPauseButton', 'paused']);\n        this.playPauseButton.addEventListener(\n            'click',\n            this.playPause\n        );\n\n        this.loadProgressEl = createDom('div', ['loadProgress']);\n        this.progressEl = createDom('div', ['playProgress']);\n\n        const track = createDom('div', ['track'], [this.loadProgressEl, this.progressEl]);\n        this.clockEl = createDom('div', ['clock']);\n\n        this.controlsContainer = createDom(\n            'div',\n            ['videoControls', 'disabled'],\n            [ this.playPauseButton, track, this.clockEl ]\n        );\n    }\n\n    private setDuration(seconds : number) {\n        this.duration = seconds;\n        if (this.durationEl) this.durationEl.innerText = formatTime(seconds);\n    }\n\n\n    private setCurrentTime(seconds : number) {\n        const playedPc = Math.round((seconds / this.duration) * 100);\n        this.progressEl.style.width = `${playedPc}%`;\n        if (this.clockEl) this.clockEl.innerText = formatTime(seconds);\n    }\n\n    private playPause = () => {\n        if (this.video.paused) {\n            this.video.play();\n        } else {\n            this.video.pause();\n        }\n\n        this.playPauseButton.classList.toggle('playing');\n    }\n\n    private canPlay = () => {\n        this.setCurrentTime(this.video.currentTime);\n        this.controlsContainer.classList.remove('disabled');\n        this.video.classList.add('visible');\n    }\n\n    private gotMetadata = () => {\n        this.setDuration(Math.round(this.video.duration));\n    }\n\n    private endedPlayback = () => {\n        if (Math.round(this.video.currentTime) === Math.round(this.duration)) {\n            this.video.currentTime = 0;\n            this.setCurrentTime(0);\n        }\n    }\n\n    private timeUpdate = () => {\n        this.setCurrentTime(Math.round(this.video.currentTime));\n    }\n\n    private loadProgress = () => {\n        const ranges = this.video.buffered;\n        if (ranges.length === 0)\n            return;\n\n        const seconds = ranges.end(0)\n\n        const loadPc = Math.round((seconds / this.duration) * 100);\n        this.loadProgressEl.style.width = `${loadPc}%`;\n    }\n}","import { startPage } from \"./Page\";\n\ndocument.addEventListener('DOMContentLoaded', startPage);","function createDom(\n    tagName : string,\n    classList : string[] = [],\n    content : string | Element | Element[] | null = null,\n    parent : Element | null = null) : HTMLElement\n{\n\n    let dom = document.createElement(tagName);\n\n    if (classList.length > 0) {\n        for (const cl of classList) {\n            dom.classList.add(cl);\n        }\n    }\n\n    if (content !== null) {\n        if (typeof(content) === \"string\") {\n            dom.insertAdjacentText('beforeend', content);\n        } else if (content instanceof Element) {\n            dom.insertAdjacentElement('beforeend', content);\n        } else if (Array.isArray(content)) {\n            for (const el of content) {\n                dom.insertAdjacentElement('beforeend', el);\n            }\n        }\n    }\n\n    if (parent) {\n        parent.insertAdjacentElement('beforeend', dom);\n    }\n\n    return dom;\n}\n\nexport { createDom }"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvUGFnZS50cyIsInNyYy9WaWRlb0NvbnRyb2xzLnRzIiwic3JjL21haW4udHMiLCJzcmMvdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7QUNBQSxJQUFBLGtCQUFBLFFBQUEsaUJBQUEsQ0FBQTtBQUVBLElBQU0sV0FBVyxDQUFBLEtBQUEsRUFBakIsS0FBaUIsQ0FBakI7QUFDQSxJQUFNLFNBQVMsQ0FBQSxLQUFBLEVBQUEsS0FBQSxFQUFmLE1BQWUsQ0FBZjtBQUVBLFNBQUEsU0FBQSxDQUFBLElBQUEsRUFBQSxHQUFBLEVBQWtEO0FBQzlDLFFBQU0sUUFBUSxTQUFTLEtBQUEsT0FBQSxDQUF2QixPQUF1QixDQUFULENBQWQ7QUFDQSxRQUFNLFNBQVMsU0FBUyxLQUFBLE9BQUEsQ0FBeEIsUUFBd0IsQ0FBVCxDQUFmO0FBQ0EsUUFBTSxNQUFNLEtBQUEsT0FBQSxDQUFBLEtBQUEsS0FBWixVQUFBO0FBRUEsUUFBTSxNQUFNLElBQUEsS0FBQSxDQUFBLEtBQUEsRUFBWixNQUFZLENBQVo7QUFDQSxRQUFBLFNBQUEsQ0FBQSxHQUFBLENBQUEsUUFBQTtBQUNBLFFBQUEsTUFBQSxHQUFhLFlBQUE7QUFBTSxlQUFBLElBQUEsU0FBQSxDQUFBLEdBQUEsQ0FBQSxTQUFBLENBQUE7QUFBbkIsS0FBQTtBQUNBLFFBQUEsR0FBQSxHQUFBLEdBQUE7QUFDQSxRQUFBLEdBQUEsR0FBQSxHQUFBO0FBRUEsUUFBTSxZQUFZLEtBQUEsYUFBQSxDQUFBLFFBQUEsS0FBbEIsSUFBQTtBQUVBLGNBQUEscUJBQUEsQ0FBQSxXQUFBLEVBQUEsR0FBQTtBQUNIO0FBRUQsU0FBQSxTQUFBLENBQUEsSUFBQSxFQUFBLEdBQUEsRUFBaUQ7QUFDN0MsUUFBTSxRQUFRLFNBQVMsS0FBQSxPQUFBLENBQXZCLE9BQXVCLENBQVQsQ0FBZDtBQUNBLFFBQU0sU0FBUyxTQUFTLEtBQUEs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LG9CQUFJLHFCQUFKLENBQTBCLFdBQTFCLEVBQXVDLEVBQXZDO0FBQ0g7QUFDSjtBQUNKO0FBRUQsUUFBSSxNQUFKLEVBQVk7QUFDUixlQUFPLHFCQUFQLENBQTZCLFdBQTdCLEVBQTBDLEdBQTFDO0FBQ0g7QUFFRCxXQUFPLEdBQVA7QUFDSDtBQUVRLFFBQUEsU0FBQSxHQUFBLFNBQUEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbXBvcnQgeyBWaWRlb0NvbnRyb2xzIH0gZnJvbSBcIi4vVmlkZW9Db250cm9sc1wiO1xuXG5jb25zdCBtb3ZpZVNmeCA9IFsnbW92JywgJ21wNCddO1xuY29uc3QgaW1nU2Z4ID0gWydqcGcnLCAncG5nJywgJ3dlYnAnXTtcblxuZnVuY3Rpb24gZmlsbEltYWdlKGl0ZW0gOiBIVE1MRWxlbWVudCwgc3JjOiBzdHJpbmcpIHtcbiAgICBjb25zdCB3aWR0aCA9IHBhcnNlSW50KGl0ZW0uZGF0YXNldFsnd2lkdGgnXSk7XG4gICAgY29uc3QgaGVpZ2h0ID0gcGFyc2VJbnQoaXRlbS5kYXRhc2V0WydoZWlnaHQnXSk7XG4gICAgY29uc3QgYWx0ID0gaXRlbS5kYXRhc2V0WydhbHQnXSB8fCBcIlVJIGltYWdlXCI7XG5cbiAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2Uod2lkdGgsIGhlaWdodCk7XG4gICAgaW1nLmNsYXNzTGlzdC5hZGQoJ3Bvc3RlcicpO1xuICAgIGltZy5vbmxvYWQgPSAoKSA9PiBpbWcuY2xhc3NMaXN0LmFkZCgndmlzaWJsZScpO1xuICAgIGltZy5hbHQgPSBhbHQ7XG4gICAgaW1nLnNyYyA9IHNyYztcblxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGl0ZW0ucXVlcnlTZWxlY3RvcignLmZyYW1lJykgfHwgaXRlbTtcblxuICAgIGNvbnRhaW5lci5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2JlZm9yZWVuZCcsIGltZyk7XG59XG5cbmZ1bmN0aW9uIGZpbGxNb3ZpZShpdGVtOiBIVE1MRWxlbWVudCwgc3JjOiBzdHJpbmcpIHtcbiAgICBjb25zdCB3aWR0aCA9IHBhcnNlSW50KGl0ZW0uZGF0YXNldFsnd2lkdGgnXSk7XG4gICAgY29uc3QgaGVpZ2h0ID0gcGFyc2VJbnQoaXRlbS5kYXRhc2V0WydoZWlnaHQnXSk7XG5cbiAgICBjb25zdCBtb3ZpZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ2aWRlb1wiKTtcbiAgICBtb3ZpZS53aWR0aCA9IHdpZHRoO1xuICAgIG1vdmllLmhlaWdodCA9IGhlaWdodDtcbiAgICBtb3ZpZS5jbGFzc0xpc3QuYWRkKCdwb3N0ZXInKTtcbiAgICBjb25zdCBjb250cm9scyA9IG5ldyBWaWRlb0NvbnRyb2xzKG1vdmllKTtcblxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGl0ZW0ucXVlcnlTZWxlY3RvcignLmZyYW1lJykgfHwgaXRlbTtcbiAgICBjb250YWluZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdiZWZvcmVlbmQnLCBtb3ZpZSk7XG4gICAgY29udGFpbmVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgY29udHJvbHMudWkpO1xuXG4gICAgbW92aWUuc3JjID0gc3JjO1xufVxuXG5cbmZ1bmN0aW9uIGZpbGxJdGVtKGl0ZW0gOiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IHNyYyA9IGl0ZW0uZGF0YXNldFsnc3JjJ107XG4gICAgY29uc3QgY29tcHMgPSBzcmMuc3BsaXQoJy4nKTtcbiAgICBpZiAoY29tcHMubGVuZ3RoIDwgMikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ05vIGZpbGUgc3VmZml4IG9uIHNvdXJjZScsIHNyYyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBzZnggPSBjb21wc1tjb21wcy5sZW5ndGggLSAxXTtcblxuICAgIGlmKG1vdmllU2Z4LmluZGV4T2Yoc2Z4KSAhPT0gLTEpIHtcbiAgICAgICAgZmlsbE1vdmllKGl0ZW0sIHNyYyk7XG4gICAgfSBlbHNlIGlmIChpbWdTZnguaW5kZXhPZihzZngpICE9PSAtMSkge1xuICAgICAgICBmaWxsSW1hZ2UoaXRlbSwgc3JjKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJEb24ndCBrbm93IGhvdyB0byBmaWxsIGl0ZW0gdHlwZTogXCIsIHNmeCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBkaWRPYnNlcnZlKGVudHJpZXM6IEludGVyc2VjdGlvbk9ic2VydmVyRW50cnlbXSwgb2JzZXJ2ZXIgOiBJbnRlcnNlY3Rpb25PYnNlcnZlcikge1xuICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcykge1xuICAgICAgICAvLyBTaG91bGQgYWx3YXlzIGJlIHRydWUgKD8pXG4gICAgICAgIGlmIChlbnRyeS5pbnRlcnNlY3Rpb25SYXRpbyA+PSAwLjUpIHtcbiAgICAgICAgICAgIGZpbGxJdGVtKGVudHJ5LnRhcmdldCBhcyBIVE1MRWxlbWVudCk7XG4gICAgICAgICAgICBvYnNlcnZlci51bm9ic2VydmUoZW50cnkudGFyZ2V0KTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0UGFnZSgpIHtcbiAgICBjb25zdCBpdGVtRWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaXRlbScpO1xuICAgIGlmICghaXRlbUVsZW1lbnRzKVxuICAgICAgICByZXR1cm47XG5cbiAgICBjb25zdCBpbyA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihkaWRPYnNlcnZlLCB7IHRocmVzaG9sZCA6IDAuNSB9KTtcbiAgICBpdGVtRWxlbWVudHMuZm9yRWFjaCgoZWwgOiBFbGVtZW50KSA9PiBpby5vYnNlcnZlKGVsKSk7XG59IiwiaW1wb3J0IHsgY3JlYXRlRG9tIH0gZnJvbSBcIi4vdXRpbFwiO1xuXG5jb25zdCBmb3JtYXRUaW1lID0gKHRpbWU6IG51bWJlcikgOiBzdHJpbmcgPT4ge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25zdCBtaW51dGVzID0gYCR7TWF0aC5mbG9vcih0aW1lIC8gNjApfWAucGFkU3RhcnQoMiwgJzAnKTtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3Qgc2Vjb25kcyA9IGAke01hdGguZmxvb3IodGltZSAlIDYwKX1gLnBhZFN0YXJ0KDIsICcwJyk7XG5cbiAgICByZXR1cm4gYCR7bWludXRlc306JHtzZWNvbmRzfWA7XG59O1xuXG5cbmV4cG9ydCBjbGFzcyBWaWRlb0NvbnRyb2xzIHtcbiAgICBwcml2YXRlIHZpZGVvIDogSFRNTFZpZGVvRWxlbWVudDtcblxuICAgIHByaXZhdGUgZHVyYXRpb24gOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBkdXJhdGlvbkVsIDogSFRNTEVsZW1lbnQ7XG5cbiAgICBwcml2YXRlIHByb2dyZXNzRWwgOiBIVE1MRWxlbWVudDtcbiAgICBwcml2YXRlIGxvYWRQcm9ncmVzc0VsIDogSFRNTEVsZW1lbnQ7XG4gICAgcHJpdmF0ZSBjbG9ja0VsIDogSFRNTEVsZW1lbnQ7XG4gICAgcHJpdmF0ZSBwbGF5UGF1c2VCdXR0b24gOiBIVE1MRWxlbWVudDtcblxuICAgIHByaXZhdGUgY29udHJvbHNDb250YWluZXIgOiBIVE1MRWxlbWVudDtcblxuICAgIGNvbnN0cnVjdG9yKHZpZGVvIDogSFRNTFZpZGVvRWxlbWVudCkge1xuICAgICAgICB0aGlzLnZpZGVvID0gdmlkZW87XG5cbiAgICAgICAgdGhpcy5zZXR1cFVJKCk7XG5cbiAgICAgICAgdGhpcy52aWRlby5hZGRFdmVudExpc3RlbmVyKCdjYW5wbGF5JywgdGhpcy5jYW5QbGF5KTtcbiAgICAgICAgdGhpcy52aWRlby5hZGRFdmVudExpc3RlbmVyKCd0aW1ldXBkYXRlJywgdGhpcy50aW1lVXBkYXRlKTtcbiAgICAgICAgdGhpcy52aWRlby5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIHRoaXMubG9hZFByb2dyZXNzKTtcbiAgICAgICAgdGhpcy52aWRlby5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsIHRoaXMuZW5kZWRQbGF5YmFjayk7XG4gICAgICAgIHRoaXMudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignbG9hZGVkbWV0YWRhdGEnLCB0aGlzLmdvdE1ldGFkYXRhKTtcblxuICAgICAgICAvLyBTb21ldGltZXMgdGhlIHZpZGVvIGNuYSBiZSBpbiB0aGUgcmVhZHkgc3RhdGUgYmVmb3JlIHdlIGF0dGFjaCB0aGUgbGlzdGVuZXJzXG4gICAgICAgIC8vIElmIHRoaXMgaXMgdGhlIGNhc2UgZmlsbCBldmVyeXRoaW5nIGluIG1hbnVhbGx5Li4uXG4gICAgICAgIGlmICh0aGlzLnZpZGVvLnJlYWR5U3RhdGUgPj0gMikge1xuICAgICAgICAgICAgdGhpcy5jYW5QbGF5KCk7XG4gICAgICAgICAgICB0aGlzLnNldER1cmF0aW9uKHRoaXMudmlkZW8uZHVyYXRpb24pO1xuICAgICAgICAgICAgdGhpcy5sb2FkUHJvZ3Jlc3MoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgdWkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnRyb2xzQ29udGFpbmVyO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0dXBVSSgpIHtcbiAgICAgICAgdGhpcy5wbGF5UGF1c2VCdXR0b24gPSBjcmVhdGVEb20oJ2RpdicsIFsncGxheVBhdXNlQnV0dG9uJywgJ3BhdXNlZCddKTtcbiAgICAgICAgdGhpcy5wbGF5UGF1c2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICdjbGljaycsXG4gICAgICAgICAgICB0aGlzLnBsYXlQYXVzZVxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMubG9hZFByb2dyZXNzRWwgPSBjcmVhdGVEb20oJ2RpdicsIFsnbG9hZFByb2dyZXNzJ10pO1xuICAgICAgICB0aGlzLnByb2dyZXNzRWwgPSBjcmVhdGVEb20oJ2RpdicsIFsncGxheVByb2dyZXNzJ10pO1xuXG4gICAgICAgIGNvbnN0IHRyYWNrID0gY3JlYXRlRG9tKCdkaXYnLCBbJ3RyYWNrJ10sIFt0aGlzLmxvYWRQcm9ncmVzc0VsLCB0aGlzLnByb2dyZXNzRWxdKTtcbiAgICAgICAgdGhpcy5jbG9ja0VsID0gY3JlYXRlRG9tKCdkaXYnLCBbJ2Nsb2NrJ10pO1xuXG4gICAgICAgIHRoaXMuY29udHJvbHNDb250YWluZXIgPSBjcmVhdGVEb20oXG4gICAgICAgICAgICAnZGl2JyxcbiAgICAgICAgICAgIFsndmlkZW9Db250cm9scycsICdkaXNhYmxlZCddLFxuICAgICAgICAgICAgWyB0aGlzLnBsYXlQYXVzZUJ1dHRvbiwgdHJhY2ssIHRoaXMuY2xvY2tFbCBdXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXREdXJhdGlvbihzZWNvbmRzIDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuZHVyYXRpb24gPSBzZWNvbmRzO1xuICAgICAgICBpZiAodGhpcy5kdXJhdGlvbkVsKSB0aGlzLmR1cmF0aW9uRWwuaW5uZXJUZXh0ID0gZm9ybWF0VGltZShzZWNvbmRzKTtcbiAgICB9XG5cblxuICAgIHByaXZhdGUgc2V0Q3VycmVudFRpbWUoc2Vjb25kcyA6IG51bWJlcikge1xuICAgICAgICBjb25zdCBwbGF5ZWRQYyA9IE1hdGgucm91bmQoKHNlY29uZHMgLyB0aGlzLmR1cmF0aW9uKSAqIDEwMCk7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3NFbC5zdHlsZS53aWR0aCA9IGAke3BsYXllZFBjfSVgO1xuICAgICAgICBpZiAodGhpcy5jbG9ja0VsKSB0aGlzLmNsb2NrRWwuaW5uZXJUZXh0ID0gZm9ybWF0VGltZShzZWNvbmRzKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBsYXlQYXVzZSA9ICgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMudmlkZW8ucGF1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLnZpZGVvLnBsYXkoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudmlkZW8ucGF1c2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucGxheVBhdXNlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ3BsYXlpbmcnKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNhblBsYXkgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0Q3VycmVudFRpbWUodGhpcy52aWRlby5jdXJyZW50VGltZSk7XG4gICAgICAgIHRoaXMuY29udHJvbHNDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgdGhpcy52aWRlby5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnb3RNZXRhZGF0YSA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXREdXJhdGlvbihNYXRoLnJvdW5kKHRoaXMudmlkZW8uZHVyYXRpb24pKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGVuZGVkUGxheWJhY2sgPSAoKSA9PiB7XG4gICAgICAgIGlmIChNYXRoLnJvdW5kKHRoaXMudmlkZW8uY3VycmVudFRpbWUpID09PSBNYXRoLnJvdW5kKHRoaXMuZHVyYXRpb24pKSB7XG4gICAgICAgICAgICB0aGlzLnZpZGVvLmN1cnJlbnRUaW1lID0gMDtcbiAgICAgICAgICAgIHRoaXMuc2V0Q3VycmVudFRpbWUoMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHRpbWVVcGRhdGUgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0Q3VycmVudFRpbWUoTWF0aC5yb3VuZCh0aGlzLnZpZGVvLmN1cnJlbnRUaW1lKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBsb2FkUHJvZ3Jlc3MgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJhbmdlcyA9IHRoaXMudmlkZW8uYnVmZmVyZWQ7XG4gICAgICAgIGlmIChyYW5nZXMubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGNvbnN0IHNlY29uZHMgPSByYW5nZXMuZW5kKDApXG5cbiAgICAgICAgY29uc3QgbG9hZFBjID0gTWF0aC5yb3VuZCgoc2Vjb25kcyAvIHRoaXMuZHVyYXRpb24pICogMTAwKTtcbiAgICAgICAgdGhpcy5sb2FkUHJvZ3Jlc3NFbC5zdHlsZS53aWR0aCA9IGAke2xvYWRQY30lYDtcbiAgICB9XG59IiwiaW1wb3J0IHsgc3RhcnRQYWdlIH0gZnJvbSBcIi4vUGFnZVwiO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgc3RhcnRQYWdlKTsiLCJmdW5jdGlvbiBjcmVhdGVEb20oXG4gICAgdGFnTmFtZSA6IHN0cmluZyxcbiAgICBjbGFzc0xpc3QgOiBzdHJpbmdbXSA9IFtdLFxuICAgIGNvbnRlbnQgOiBzdHJpbmcgfCBFbGVtZW50IHwgRWxlbWVudFtdIHwgbnVsbCA9IG51bGwsXG4gICAgcGFyZW50IDogRWxlbWVudCB8IG51bGwgPSBudWxsKSA6IEhUTUxFbGVtZW50XG57XG5cbiAgICBsZXQgZG9tID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKTtcblxuICAgIGlmIChjbGFzc0xpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IGNsIG9mIGNsYXNzTGlzdCkge1xuICAgICAgICAgICAgZG9tLmNsYXNzTGlzdC5hZGQoY2wpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNvbnRlbnQgIT09IG51bGwpIHtcbiAgICAgICAgaWYgKHR5cGVvZihjb250ZW50KSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgZG9tLmluc2VydEFkamFjZW50VGV4dCgnYmVmb3JlZW5kJywgY29udGVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAoY29udGVudCBpbnN0YW5jZW9mIEVsZW1lbnQpIHtcbiAgICAgICAgICAgIGRvbS5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2JlZm9yZWVuZCcsIGNvbnRlbnQpO1xuICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY29udGVudCkpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZWwgb2YgY29udGVudCkge1xuICAgICAgICAgICAgICAgIGRvbS5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2JlZm9yZWVuZCcsIGVsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwYXJlbnQpIHtcbiAgICAgICAgcGFyZW50Lmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgZG9tKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZG9tO1xufVxuXG5leHBvcnQgeyBjcmVhdGVEb20gfSJdfQ=="}